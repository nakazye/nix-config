* こんな感じで作っていったよログ

** WSL環境
*** powershell上での操作

- [[https://github.com/nix-community/NixOS-WSL/releases][NixOS-WSL]]から最新のnixos-wsl.tar.gzをダウンロード
- ファイルを作成する場所を指定してイメージをインポート
- デフォルトで起動するwslをNixOSに
  
#+begin_src shell
  wsl --import NixOS $env:USERPROFILE\NixOS\ ./nixos-wsl.tar.gz --version 2
  wsl -s NixOS
#+end_src

*** nixOS上での操作
**** NixOSのUpdate
#+begin_src shell
  sudo nix-channel --update
  sudo nixos-rebuild switch
#+end_src

**** テンプレートのダウンロード
- 新規にnix-config作り直すので、テンプレダウンロード
- flakesを使える様に

#+begin_src shell
  export NIX_CONFIG="experimental-features = nix-command flakes"
  mkdir -p ~/.local/share/nix-config
  cd ~/.local/share/nix-config
  nix flake init -t github:misterio77/nix-starter-config#standard
#+end_src

**** ユーザ名/ホスト指定
./home-manager/home.nixに対して
#+begin_src nix
    home = {
      username = "your-username";
      homeDirectory = "/home/your-username";
    };
#+end_src
を
#+begin_src nix
    home = {
      username = "nixos";
      homeDirectory = "/home/nixos";
    };
#+end_src
に変更

#+begin_src nix
  "your-username@your-hostname" = home-manager.lib.homeManagerConfiguration {
#+end_src
を
#+begin_src nix
  "nixos@wsl-nixos" = home-manager.lib.homeManagerConfiguration {
#+end_src
に変更

**** その他もろもろ
[[https://zenn.dev/tositada/books/1c1564531ec8fc][nixos入門: wslで使うnixos]]を参考に諸々設定

**** 日本語入力
[[https://qiita.com/feles-ao42/items/fcb507dab03db5de067d][NIX OS入門]]を見ると
#+begin_src nix
  i18n.inputMethod = {
    enabled = "fcitx5";
    enable = true;
    fcitx5.addons = with pkgs; [
      fcitx5-mozc
      fcitx5-gtk
    ];
  };
#+end_src
をconfiguration.nixに追加で良いらしい
→
うまくいかなかった(fcitx5の設定でmozcが出てこない)ので
#+begin_src nix
    i18n.inputMethod = {
      enable = true;
      type = "ibus";
      ibus.engines = with pkgs.ibus-engines; [ anthy ];
    };
#+end_src
で設定。うまくいった！！！

#+begin_src shell
  sudo nixos-rebuild switch --flake .#wsl-nixos
#+end_src
を設定変更後実行すると問題なく諸々DLされた上で通るので、それでよさそう
Powershell側で ~wsl --shutdown~ を叩いて再起動
再起動後、 ~ibus-setup~ をnixos側で叩いてanthyを設定

*** 動作確認
**** nixos-rebuild
#+begin_src shell
  sudo nixos-rebuild switch --flake .#wsl-nixos
#+end_src
でエラー出ないこと

**** homemanager
#+begin_src shell
  home-manager switch --flake .#nixos@wsl-nixos
#+end_src
でエラー出ないこと

*** 現状
設定を色々入れ込んでいくぞ！
